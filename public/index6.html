<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Table</title>
    <style>
        #device-table {
            border-collapse: collapse;
        }
        
        #device-table th, #device-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        #loading-indicator {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Device Table</h1>
    <table id="device-table">
        <thead>
            <tr>
                <th>Device ID</th>
                <th>Device Name</th>
                <th>Device Type</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <div id="loading-indicator">
        <p>Loading...</p>
    </div>
    
    <script>
        // SQLite database connection
        const db = new Promise((resolve, reject) => {
            let sqlite3 = require('sqlite3').verbose();
            let db = new sqlite3.Database('devices.db', (err) => {
                if (err) {
                    console.error(err);
                    reject(err);
                } else {
                    resolve(db);
                }
            });
        }).then((db) => db).catch((err) => {
            console.error(err);
            // display error message to user or retry the operation
        });
        
        function updateDeviceTable() {
            document.getElementById('loading-indicator').style.display = 'block';
            
            try {
                db.all("SELECT * FROM devices", (err, rows) => {
                    if (err) {
                        console.error(err);
                        // display error message to user or retry the operation
                    } else {
                        const deviceTable = document.getElementById('device-table');
                        
                        // clear existing data
                        while (deviceTable.rows.length > 0) {
                            deviceTable.deleteRow(0);
                        }
                        
                        // populate device table with data from rows
                        rows.forEach((row) => {
                            const newRow = deviceTable.insertRow();
                            
                            const deviceIdCell = newRow.insertCell();
                            deviceIdCell.textContent = row.id;
                            
                            const deviceNameCell = newRow.insertCell();
                            deviceNameCell.textContent = row.name;
                            
                            const deviceTypeCell = newRow.insertCell();
                            deviceTypeCell.textContent = row.type;
                        });
                        
                        document.getElementById('loading-indicator').style.display = 'none';
                    }
                });
            } catch (e) {
                console.error(e);
                // display error message to user or retry the operation
            }
        }
        
        updateDeviceTable();
    </script>
</body>
</html>
